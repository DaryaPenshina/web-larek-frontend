# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении
Карточка

export interface ICardItem {
  id: string;
  title: string;
  description: string;
  category: string;
  image: string;
  price: number | null;
}

Интерфейс для модели данных карточек

export interface IProductsList {
  products: ICardItem[];
  preview: string | null;
}

Этот интерфейс представляет собой форму для заказа и содержит поля, которые пользователь должен заполнить при оформлении покупки

export interface IOrderForm {
  payment?: string;
  address?: string;
  phone?: string;
  email?: string;
  total?: string | number;
}

Этот интерфейс расширяет IOrderForm и представляет полный заказ, который включает не только данные, введенные пользователем, но и список товаров

export interface IOrder extends IOrderForm {
  items: string[];
}

Этот интерфейс представляет результат оформления заказа, который может содержать идентификатор созданного заказа

export interface IOrderResult {
  id: string;
}

Этот интерфейс описывает состояние всего приложения, включая информацию о каталоге, корзине и текущем заказе

export interface IAppState {
  catalog: ICardItem[];
  preview: string;
  basket: string[];
  order: IOrder;
  total: string | number;
  loading: boolean;
}

## Архитектура

Используем архитектуру MVP (Model-View-Presenter), обеспечивающую разделение логики приложения и их представления. 

### Основные части архитектуры проекта:

1. Слой МОДЕЛЬ (Model):
- Отвечает за данные приложения и бизнес-логику, взаимодействие с API и управление состоянием.

2. Слой ПРЕДСТАВЛЕНИЕ (View):
- Отвечает за отображение данных на экране и взаимодействие с пользователем.


3. Слой ПРЕЗЕНТЕР (Presenter):
- Обеспечивает связь между моделью и представлениями, управляет логикой взаимодействия.
- Презентеры управляют всеми пользовательскими событиями, передавая данные от представлений к модели и обратно.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
- Методы:
`get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает пропис с объектом, которым ответил сервер
`post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отпралвяет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется POST запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы:
`on` - подписка на событие
`emit` - инициализация события
`trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### СЛОЙ МОДЕЛЬ (Model)

#### Класс CardApi

Этот класс отвечает за взаимодействие с API , обеспечивая методы для получения данных о продуктах и списка заказов.

Конструктор
- принимает передает в родительский конструктор Api поля baseUrl 
- принимает и сохраняет входящий url запроса 

Поля:

`BASE_URL` строка, содержащая базовый URL для API.

Методы:

`get_products` выполняет GET-запрос к API для получения списка всех продуктов. Возвращает список продуктов в формате JSON.
`place_order` принимает объект с данными заказа и выполняет POST-запрос для размещения заказа на сервере. Возвращает ответ сервера в формате JSON.

#### Класс AppState

Этот класс представляет состояние приложения, храня данные о продуктах, корзине и форме заказа.

Поля:

`catalog` список объектов продуктов, доступных в магазине.
`preview` — Ссылка  на элемент, который находится в режиме предварительного просмотра
`preview_order` - Данные текущего заказа
`basket` список объектов продуктов, добавленных в корзину.
`basket_addition` - Общая стоимость товаров в корзине
`order_form`  данные формы заказа 

Методы:

`add_to_cart`- принимает объект продукта и добавляет его в корзину.
`remove_from_cart`- принимает идентификатор продукта и удаляет его из корзины.
`set_order_form`- устанавливает данные формы заказа.
`get_catalog`- возвращает список доступных продуктов из каталога.
`set_catalog`- принимает список продуктов и обновляет каталог.
`getBasket` - Метод, который вычисляет общую стоимость товаров в текущем заказе, суммируя цены продуктов

#### Класс ProductItem

Этот класс представляет отдельный продукт в магазине, включая его атрибуты.

Поля:

`id`: уникальный идентификатор продукта.
`title`: название продукта.
`description`: описание продукта.
`category`: категория, к которой принадлежит продукт.
`image_url`: URL изображения продукта.
`price`: цена продукта.

Методы:

`repr` возвращает строковое представление объекта, отображающее идентификатор, название и цену продукта.

### СЛОЙ ВИД (View)

#### Класс ProductCard

Этот класс представляет собой компонент пользовательского интерфейса для отображения карточки продукта.

Конструктор

При создании экземпляра класса ProductCard передаётся контейнер, который используется в родительском конструкторе. Также сохраняются необходимые элементы разметки. Если передан объект actions, добавляется обработчик клика на контейнер.

Поля:
`title`: Элемент DOM для отображения названия карточки
`category`: Элемент DOM для отображения категории карточки
`image`: Элемент изображения, отображающий картинку карточки
`price`: Элемент DOM для отображения цены карточки

Методы:

`setTitle`: Устанавливает текст элемента _title. Обновляет содержимое с помощью метода из базового класса.
`setCategory`: Устанавливает текст элемента _category и CSS-класс в зависимости от категории.
`setImage`: Обновляет атрибут src элемента _image 
`setPrice`: Устанавливает текст элемента _price. Если значение null, отображается "Бесценно", иначе — цена с текстом "синапсов".

#### Класс PreviewCard

Класс PreviewCard предназначен для отображения карточек предпросмотра

Конструктор принимает элемент контейнера типа HTMLElement и опциональный объект событий ICardEvents:

interface ICardEvents {
  onClick: (event: MouseEvent) => void;
}

Поля

`text`: Находит кнопку в карточке по заданному селектору.
`button`: Использует утилиту для получения элемента с текстом карточки.

Методы:
`setText`: Устанавливает текстовое содержимое элемента _text.

#### Класс ShoppingCartItem

Класс ShoppingCartItem отвечает за отображение информации о товаре в корзине. Он включает заголовок, цену, индекс и кнопку, а также позволяет устанавливать значения для этих элементов. Класс обрабатывает клики по кнопке, если передан соответствующий обработчик в конструктор.

interface ICartItemData {
  title: string;
  price: number;
  index: number;
}

Конструктор

Конструктор передаёт контейнер в родительский класс и сохраняет необходимые элементы разметки в полях. Если передан объект событий, добавляет обработчик клика на кнопку button, а слушатель на контейнере удаляется.

Поля

`title`: Находит элемент с классом .item__title и сохраняет его.
`button`: Находит элемент с классом .item__button.
`price`: Находит элемент с классом .item__price.
`index`: Находит элемент с классом .cart__item-index.


#### Класс Cart

Класс Cart управляет корзиной покупок на веб-странице, отображая товары и их общую стоимость. 

interface ICart {
  items: HTMLElement[];
  total: number;
}

Конструктор принимает контейнер типа HTMLElement и объект событий типа IEvent. Он сохраняет необходимые элементы:

Поля

`itemList`: Элемент списка товаров в корзине.
`totalAmount`: Элемент, показывающий общую стоимость корзины.
`button`: Кнопка для открытия страницы оформления заказа.

Методы

`setItems`: Устанавливает новые товары в корзину. Если массив пустой, отображает сообщение "Корзина пуста".
`setTotal`: Устанавливает общую стоимость корзины и обновляет текст элемента с указанием суммы.


#### Класс Order

Класс Order управляет формой оформления заказа. Он наследуется от класса Form<T> и реализует интерфейс IOrderForm.

Интерфейс IOrderForm

TypeScript
export interface IOrderForm {
  payment?: string;
  address?: string;
  phone?: string;
  email?: string;
  total?: string | number;
}

Конструктор

Принимает элемент контейнера типа HTMLElement и объект событий типа IEvent, сохраняет нужные элементы формы. На кнопки выбора способа оплаты добавляет обработчик клика, который активирует соответствующую кнопку.

Поля

`buttons`: хранит элементы кнопок формы оплаты.

Методы

`setPayment`: Устанавливает активное состояние для кнопок оплаты.
`setAddress`: Устанавливает значение поля адреса в форме.

#### Класс ContactInfo

Класс ContactInfo отвечает за управление контактной формой, устанавливая значения для полей телефона и электронной почты. 

Методы

`setPhone`: Устанавливает значение поля телефона.
`setEmail`: Устанавливает значение поля электронной почты.


#### Класс Result

Класс Result отвечает за отображение успешного оформления заказа в модальном окне

Интерфейс ISuccess

interface ISuccess {
  total: number;
}

Конструктор

Принимает элемент контейнера типа HTMLElement и опциональный объект действий. сохраняет необходимые элементы и, если передан объект действий, добавляет обработчик клика на кнопку закрытия.

Поля

`total`: хранит элемент с общей суммой заказа.
`close`: хранит элемент кнопки для закрытия окна.

Методы

`setTotal`: Устанавливает значение общей суммы заказа. 

### СЛОЙ ПРЕЗЕНТЕР (Presenter)

#### Класс EventDispatcher
Назначение: Управляет событиями, регистрацией слушателей и их вызовом.
Методы:
`on`(event: string, listener: Function): void — добавляет слушателя на событие.
`off`(event: string, listener: Function): void — удаляет слушателя с события.
`dispatch`(event: string, data?: any): void — вызывает событие и передает данные.

#### Класс Presenter
Назначение: Управляет взаимодействием между моделью и представлениями.
Поля:
`modal`  — экземпляр модального окна для отображения информации.
`appState`  — экземпляр состояния приложения для доступа к данным о продуктах и корзине.
Методы:
`addToCart` — добавляет товар в корзину и обновляет представление.
`removeFromCart` — удаляет товар из корзины и обновляет представление.
`showProductDetails` — открывает модальное окно с информацией о товаре.
`validateAndProceedToCheckout` — проверяет введенные данные и позволяет перейти к оформлению заказа, если данные валидны.

#### Класс CheckoutPresenter
Назначение: Управляет процессом оформления заказа.
Поля:
`form`  — экземпляр формы для ввода данных.
`basket` — экземпляр корзины.
Методы:
`submitOrder`  — управляет отправкой заказа и обработкой данных формы.
`resetForm`  — очищает поля формы после успешного оформления заказа, чтобы позволить пользователю начать новый процесс оформления.
`updateBasketOnCheckout`  — обновляет состояние корзины, удаляя товары и сбрасывая их при успешном оформлении заказа.