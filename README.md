# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```


## Архитектура

Используем архитектуру MVP (Model-View-Presenter), обеспечивающую разделение логики приложения и их представления. 

### Основные части архитектуры проекта:

1. Слой МОДЕЛЬ (Model):
- Отвечает за данные приложения и бизнес-логику, взаимодействие с API и управление состоянием.
- Включает классы: Api, ShopApi, AppState, Basket.
- Каждое из этих классов взаимодействует друг с другом для обеспечения целостного управления данными.

2. Слой ПРЕДСТАВЛЕНИЕ (View):
- Отвечает за отображение данных на экране и взаимодействие с пользователем.
- Включает классы: Component, Modal, ProductCard, BasketCard, Form, MainPage.
- Эти классы реализуют интерфейсы для взаимодействия пользователя и отображения информации.

3. Слой ПРЕЗЕНТЕР (Presenter):
- Обеспечивает связь между моделью и представлениями, управляет логикой взаимодействия.
- Включает классы: EventDispatcher, Presenter, CheckoutPresenter.
- Презентеры управляют всеми пользовательскими событиями, передавая данные от представлений к модели и обратно.

### Описание классов и их функций

### СЛОЙ МОДЕЛЬ (Model)

1. Класс Api
- Назначение: Определяет основные методы для работы с данными о товарах и корзине.
- Методы:
- fetchProducts(): Promise<Product[]> — получает список всех доступных товаров.
- addToCart(item: CartItem): void — добавляет товар в корзину 
- removeFromCart(itemId: number): void — удаляет товар из корзины 

2. Класс ShopApi
- Назначение: Реализует методы интерфейса Api и может хранить технологию получения данных о товарах.
- Методы:
- fetchProducts(): Promise<Product[]> — возвращает список товаров, получая их из API

3. Класс AppState
- Назначение: Хранит глобальное состояние приложения и управляет данными, доступными для различных компонентов.
- Поля:
- products: Product[] — список доступных товаров.
- basket: Basket — текущая корзина пользователя.
- Методы:
- updateBasket(items: CartItem[]): void — обновляет текущее состояние корзины на основе массива товаров, поступающего из представления (например, из BasketCard).
- getCurrentState(): { products: Product[], basket: Basket } — возвращает текущее состояние приложения.

4. Класс Basket
- Назначение: Управляет состоянием и содержимым корзины покупок.
- Поля:
- items: CartItem[] — массив товаров в корзине.
- Методы:
- setItems(items: CartItem[]): void — обновляет текущее состояние корзины на основе массива товаров, поступающего из представления (например, из BasketCard).
- addItem(item: CartItem): void — добавляет товар в корзину.
- removeItem(itemId: number): void — удаляет товар из корзины.
- getTotal(): number — вычисляет общую стоимость товаров в корзине, основанную на items.
- clear(): void — очищает корзину.

### СЛОЙ ВИД (View)

1. Класс Component
- Назначение: Базовый класс для всех компонентов интерфейса, предоставляющий общую функциональность.
- Методы:
- render(): void — отображает компонент.
- destroy(): void — очищает компонент и освобождает ресурсы.

2. Класс Modal
- Назначение: Управляет отображением модальных окон.
- Поля:
- content: string — содержимое модального окна.
- Методы:
- open(content: string): void — открывает модальное окно с содержимым.
- close(): void — закрывает модальное окно.
- setCloseListener(callback: () => void): void — устанавливает обработчик для закрытия окна.

3. Класс ProductCard
- Назначение: Отображает карточку товара.
- Поля:
- element: HTMLElement — ссылка на элемент разметки карточки товара.
- Методы:
- render(product: Product): void — отображает информацию о товаре, принимая объект товара в параметрах.
- onBuy(callback: () => void): void — обрабатывает нажатие кнопки "Купить", вызывая переданный callback, который добавляет товар в корзину.
- updatePrice(newPrice: number): void — обновляет отображаемую цену товара.

4. Класс BasketCard
- Назначение: Отображает список товаров в корзине.
- Поля:
- element: HTMLElement — ссылка на элемент разметки корзины.
- totalElement: HTMLElement — элемент для отображения общей суммы.
- buyButton: HTMLElement — кнопка для оформления заказа.
- Методы:
- render(items: CartItem[], total: number): void — отображает товары и общую сумму, принимая массив товаров и общую сумму в параметрах.
- onRemove(itemId: number, callback: () => void): void — обрабатывает нажатие кнопки "Убрать", вызывая переданный callback, который удаляет товар из корзины.
- updateTotal(total: number): void — обновляет отображение общей суммы товаров в корзине.

5. Класс Form
- Назначение: Управляет формами ввода данных (адрес, телефон, email и т.д.).
- Поля:
- fields: HTMLElement[] — массив элементов формы.
- Методы:
- getData(): object — собирает данные из полей формы.
- validate(): boolean — проверяет корректность введенных данных.
- clearFields(): void — очищает поля ввода после отправки формы.

6. Класс MainPage
- Назначение: Основной экран приложения, отображает каталог товаров и корзину.
- Поля:
- productCards: ProductCard[] — массив карточек товаров.
- basketCard: BasketCard — отображение корзины.
- element: HTMLElement — элемент разметки, в котором размещается весь контент главной страницы.
- Методы:
- render(products: Product[]): void — отображает все карточки товаров, принимая массив товаров в параметрах.
- injectBasket(basket: Basket): void — устанавливает корзину для отображения на главной странице.

### СЛОЙ ПРЕЗЕНТЕР (Presenter)

1. Класс EventDispatcher
- Назначение: Управляет событиями, регистрацией слушателей и их вызовом.
- Методы:
- on(event: string, listener: Function): void — добавляет слушателя на событие.
- off(event: string, listener: Function): void — удаляет слушателя с события.
- dispatch(event: string, data?: any): void — вызывает событие и передает данные.

2. Класс Presenter
- Назначение: Управляет взаимодействием между моделью и представлениями.
- Поля:
- modal: Modal — экземпляр модального окна для отображения информации.
- appState: AppState — экземпляр состояния приложения для доступа к данным о продуктах и корзине.
- Методы:
- addToCart(product: Product): void — добавляет товар в корзину и обновляет представление.
- removeFromCart(itemId: number): void — удаляет товар из корзины и обновляет представление.
- showProductDetails(product: Product): void — открывает модальное окно с информацией о товаре.
- validateAndProceedToCheckout(paymentData: object): boolean — проверяет введенные данные и позволяет перейти к оформлению заказа, если данные валидны.

3. Класс CheckoutPresenter
- Назначение: Управляет процессом оформления заказа.
- Поля:
- form: Form — экземпляр формы для ввода данных.
- basket: Basket — экземпляр корзины.
- Методы:
- submitOrder(): void — управляет отправкой заказа и обработкой данных формы.
- resetForm(): void — очищает поля формы после успешного оформления заказа, чтобы позволить пользователю начать новый процесс оформления.
- updateBasketOnCheckout(): void — обновляет состояние корзины, удаляя товары и сбрасывая их при успешном оформлении заказа.